<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Burn Severity Explorer | TerraNova</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <link rel="stylesheet" href="styles/map.css" />
  </head>
  <body>
    <div class="map-shell">
      <aside class="control-panel">
        <div class="panel-header">
          <p class="eyebrow">Burn Severity Explorer</p>
          <h1 data-fire-title>Camp Fire · CA</h1>
          <p class="location" data-fire-meta>Paradise & Magalia · Updated moments ago</p>
        </div>

        <section class="panel-block">
          <div class="block-header">
            <p>Recent fires</p>
            <span>Nationwide feed</span>
          </div>
          <div class="search-container">
            <div class="search-wrapper">
              <input 
                type="text" 
                placeholder="Search by state..."
                class="search-input"
                data-search-input
                autocomplete="off"
              />
              <div class="autocomplete-suggestions" data-autocomplete-suggestions style="display: none;"></div>
            </div>
            <div class="filter-row">
              <select class="filter-select" data-year-select>
                <option value="">Select year</option>
              </select>
            </div>
            <button class="search-btn" data-search-btn disabled>
              Search
            </button>
          </div>
          <div class="fire-list" data-fire-list>
            <button class="fire-card active" data-fire-id="camp-fire-2018" data-tooltip="Click to load Camp Fire analysis with burn severity mapping, watershed stress, and infrastructure overlays.">
              <div>
                <strong>Camp Fire</strong>
                <span>CA · 2018</span>
              </div>
              <span class="badge">153k ac</span>
            </button>
            <button class="fire-card" data-fire-id="dixie-fire-2021" data-tooltip="Click to load Dixie Fire analysis with burn severity mapping, watershed stress, and infrastructure overlays.">
              <div>
                <strong>Dixie Fire</strong>
                <span>CA · 2021</span>
              </div>
              <span class="badge">963k ac</span>
            </button>
          </div>
        </section>

        <section class="panel-block">
          <p class="block-label">Map layers</p>
          <label class="layer" data-tooltip="Burn severity: Pixel-level high/moderate/low/unburned classes derived from Landsat-style segmentation.">
            <input
              type="checkbox"
              data-layer="burnSeverity"
              checked
            />
            <span>Burn severity</span>
          </label>
          <label class="layer" data-tooltip="Reburn risk: Areas with elevated risk of subsequent fires based on burn history and fuel accumulation.">
            <input
              type="checkbox"
              data-layer="reburnRisk"
            />
            <span>Reburn risk</span>
          </label>
          <label class="layer" data-tooltip="Best next steps: Recommended priority areas for post-fire management and recovery actions.">
            <input
              type="checkbox"
              data-layer="bestNextSteps"
            />
            <span>Best next steps</span>
          </label>
        </section>

        <section class="panel-block priorities">
          <div class="block-header">
            <p>Analysis priorities</p>
            <span>Adjust sliders</span>
          </div>
          <div class="priority-controls">
            <label class="priority-slider" data-tooltip="Community safety: Higher values bias the model toward protecting neighborhoods, hospitals, schools, and evacuation routes.">
              <div class="priority-meta">
                <span>Community safety</span>
                <span data-priority-value="community">70%</span>
              </div>
              <input type="range" min="0" max="100" value="70" data-priority-slider="community" />
            </label>
            <label class="priority-slider" data-tooltip="Watershed health: Higher values shift focus to headwaters, drinking water sources, and sediment control.">
              <div class="priority-meta">
                <span>Watershed health</span>
                <span data-priority-value="watershed">55%</span>
              </div>
              <input type="range" min="0" max="100" value="55" data-priority-slider="watershed" />
            </label>
            <label class="priority-slider" data-tooltip="Infrastructure readiness: Higher values prioritize keeping roads, power, communications, and utilities online.">
              <div class="priority-meta">
                <span>Infrastructure readiness</span>
                <span data-priority-value="infrastructure">60%</span>
              </div>
              <input type="range" min="0" max="100" value="60" data-priority-slider="infrastructure" />
            </label>
          </div>
          <div class="priorities-list" data-priorities>
            <p class="muted small">Adjust a slider to see how the model changes course.</p>
          </div>
        </section>

        <section class="panel-block">
          <div class="block-header">
            <p>Forecast stage</p>
            <span data-forecast-label>Initial assessment (Day 7)</span>
          </div>
          <div class="slider timeline" data-tooltip="Drag to see how burn severity, watershed stress, and infrastructure exposure evolve from fire ignition through long-term recovery.">
            <input type="range" min="0" max="4" value="2" data-forecast-slider />
            <div class="slider-value" data-forecast-desc>First MTBS-inspired burn severity mapping</div>
          </div>
        </section>

        <section class="legend">
          <h2>Legend</h2>
          <div class="legend-item"><span class="dot high"></span>High priority</div>
          <div class="legend-item"><span class="dot medium"></span>Moderate priority</div>
          <div class="legend-item"><span class="dot low"></span>Low priority</div>
        </section>
      </aside>

      <section class="map-panel">
        <header class="map-header">
          <div>
            <p class="eyebrow">Live burn severity model</p>
            <h2 data-map-headline>Single fire analysis in focus</h2>
            <p class="location" data-map-subhead>Initial assessment (Day 7)</p>
          </div>
          <div class="header-meta">
            <div data-tooltip="Current weather conditions at the fire location.">
              <p class="label">Weather</p>
              <strong data-weather>72°F, Clear</strong>
            </div>
            <div data-tooltip="Reburn risk level based on burn history, fuel accumulation, and fire frequency.">
              <p class="label">Reburn risk</p>
              <strong data-reburn-risk class="risk-medium">Medium</strong>
            </div>
            <div data-tooltip="Incidents: Number of hotspots or alerts flagged by the model in this fire's footprint.">
              <p class="label">Incidents</p>
              <strong data-incidents>7 alerts</strong>
            </div>
            <button
              class="btn small ghost"
              data-tooltip="Share briefing: Generate a read-only link to this analysis for stakeholders."
              onclick="window.location.href='login.html'"
            >
              Share briefing
            </button>
          </div>
        </header>
        
        <div id="map"></div>
        
        <div class="map-legend" data-map-legend style="display: none;">
          <div class="legend-header">
            <strong data-legend-title>Legend</strong>
          </div>
          <div class="legend-items" data-legend-items>
            <!-- Legend items will be populated by JavaScript -->
          </div>
        </div>
        
        <div class="map-tip">
          <p data-map-tip>
            Tap a fire pin to load MTBS-style burn severity overlays, then drag the sliders to test scenarios.
          </p>
        </div>

        <section class="llm-qna">
          <div class="qna-header">
            <h3>Ask about this fire</h3>
            <p class="muted small">Get a plain-language summary powered by AI</p>
          </div>
          <div class="qna-input-group">
            <input 
              type="text" 
              placeholder="e.g., What caused this fire? How severe was the damage?"
              data-qna-input
            />
            <button class="btn" data-qna-submit>Ask</button>
          </div>
          <div class="qna-response" data-qna-response>
            <p class="muted small">Type a question and click "Ask" to get an AI-generated summary about the selected fire.</p>
          </div>
        </section>

        <div class="insight-rail" data-insights>
          <article>
            <p class="rail-label">Loading</p>
            <strong>Fetching latest workflow insights…</strong>
            <span>Powered by TerraNova demo API</span>
          </article>
        </div>
        
        <section class="next-steps" data-next-steps>
          <div class="next-steps-content" data-next-steps-content>
            <h3>Next steps</h3>
            <p class="muted small">Adjust the sliders to generate an action plan in plain language.</p>
          </div>
        
          <button
            class="btn analysis-dashboard-btn"
            onclick="window.location.href='analysis.html'"
          >
            Open analysis dashboard →
          </button>
        </section>        
      </section>
    </div>

    <div class="tooltip" data-tooltip-box style="display: none;"></div>

    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>
    <script src="https://unpkg.com/esri-leaflet@3.0.11/dist/esri-leaflet.js"></script>
    <script src="https://unpkg.com/proj4@2.9.0/dist/proj4.js"></script>
    <script src="https://unpkg.com/georaster@latest/dist/georaster.browser.bundle.min.js"></script>
    <script src="https://unpkg.com/georaster-layer-for-leaflet@latest/dist/v3/webpack/bundle/georaster-layer-for-leaflet.min.js"></script>
    <script src="scripts/map.js"></script>
  </body>
</html>
